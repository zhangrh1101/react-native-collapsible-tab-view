{"version":3,"names":["React","useCallback","Animated","useAfterMountEffect","useChainCallback","useCollapsibleStyle","useConvertAnimatedToValue","useScrollHandlerY","useSharedAnimatedRef","useTabNameContext","useTabsContext","useUpdateScrollViewContentSize","AnimatedFlashList","ensureFlastList","flashListModule","require","createAnimatedComponent","FlashList","error","console","FlashListMemo","memo","forwardRef","props","passRef","FlashListImpl","style","onContentSizeChange","refreshControl","contentContainerStyle","_contentContainerStyle","rest","name","setRef","contentInset","ref","recyclerRef","scrollHandler","enable","onLayout","progressViewOffset","useEffect","scrollContentSizeChange","scrollContentSizeChangeHandlers","useMemo","memoRefreshControl","cloneElement","contentInsetValue","memoContentInset","top","memoContentOffset","x","y","memoContentContainerStyle","paddingTop","refWorkaround","value","recyclerlistview_unsafe"],"sources":["FlashList.tsx"],"sourcesContent":["import type {\n  FlashListProps,\n  FlashList as SPFlashList,\n} from '@shopify/flash-list'\nimport React, { useCallback } from 'react'\nimport Animated from 'react-native-reanimated'\n\nimport {\n  useAfterMountEffect,\n  useChainCallback,\n  useCollapsibleStyle,\n  useConvertAnimatedToValue,\n  useScrollHandlerY,\n  useSharedAnimatedRef,\n  useTabNameContext,\n  useTabsContext,\n  useUpdateScrollViewContentSize,\n} from './hooks'\n\n/**\n * Used as a memo to prevent rerendering too often when the context changes.\n * See: https://github.com/facebook/react/issues/15156#issuecomment-474590693\n */\n\ntype FlashListMemoProps = React.PropsWithChildren<FlashListProps<unknown>>\ntype FlashListMemoRef = SPFlashList<any>\n\nlet AnimatedFlashList: React.ComponentClass<FlashListProps<any>> | null = null\n\nconst ensureFlastList = () => {\n  if (AnimatedFlashList) {\n    return\n  }\n\n  try {\n    const flashListModule = require('@shopify/flash-list')\n    AnimatedFlashList = (Animated.createAnimatedComponent(\n      flashListModule.FlashList\n    ) as unknown) as React.ComponentClass<FlashListProps<any>>\n  } catch (error) {\n    console.error(\n      'The optional dependency @shopify/flash-list is not installed. Please install it to use the FlashList component.'\n    )\n  }\n}\n\nconst FlashListMemo = React.memo(\n  React.forwardRef<FlashListMemoRef, FlashListMemoProps>((props, passRef) => {\n    ensureFlastList()\n    return AnimatedFlashList ? (\n      <AnimatedFlashList ref={passRef} {...props} />\n    ) : (\n      <></>\n    )\n  })\n)\n\nfunction FlashListImpl<R>(\n  {\n    style,\n    onContentSizeChange,\n    refreshControl,\n    contentContainerStyle: _contentContainerStyle,\n    ...rest\n  }: Omit<FlashListProps<R>, 'onScroll'>,\n  passRef: React.Ref<SPFlashList<any>>\n) {\n  const name = useTabNameContext()\n  const { setRef, contentInset } = useTabsContext()\n  const ref = useSharedAnimatedRef<any>(passRef)\n  const recyclerRef = useSharedAnimatedRef<any>(null)\n\n  const { scrollHandler, enable } = useScrollHandlerY(name)\n\n  const onLayout = useAfterMountEffect(rest.onLayout, () => {\n    'worklet'\n    // we enable the scroll event after mounting\n    // otherwise we get an `onScroll` call with the initial scroll position which can break things\n    enable(true)\n  })\n\n  const { progressViewOffset, contentContainerStyle } = useCollapsibleStyle()\n\n  React.useEffect(() => {\n    setRef(name, recyclerRef)\n  }, [name, recyclerRef, setRef])\n\n  const scrollContentSizeChange = useUpdateScrollViewContentSize({\n    name,\n  })\n\n  const scrollContentSizeChangeHandlers = useChainCallback(\n    React.useMemo(() => [scrollContentSizeChange, onContentSizeChange], [\n      onContentSizeChange,\n      scrollContentSizeChange,\n    ])\n  )\n\n  const memoRefreshControl = React.useMemo(\n    () =>\n      refreshControl &&\n      React.cloneElement(refreshControl, {\n        progressViewOffset,\n        ...refreshControl.props,\n      }),\n    [progressViewOffset, refreshControl]\n  )\n\n  const contentInsetValue = useConvertAnimatedToValue<number>(contentInset)\n\n  const memoContentInset = React.useMemo(() => ({ top: contentInsetValue }), [\n    contentInsetValue,\n  ])\n\n  const memoContentOffset = React.useMemo(\n    () => ({ x: 0, y: -contentInsetValue }),\n    [contentInsetValue]\n  )\n\n  const memoContentContainerStyle = React.useMemo(\n    () => ({\n      paddingTop: contentContainerStyle.paddingTop,\n      ..._contentContainerStyle,\n    }),\n    [_contentContainerStyle, contentContainerStyle.paddingTop]\n  )\n\n  const refWorkaround = useCallback(\n    (value: FlashListMemoRef | null): void => {\n      // https://github.com/Shopify/flash-list/blob/2d31530ed447a314ec5429754c7ce88dad8fd087/src/FlashList.tsx#L829\n      // We are not accessing the right element or view of the Flashlist (recyclerlistview). So we need to give\n      // this ref the access to it\n      // eslint-ignore\n      ;(recyclerRef as any)(value?.recyclerlistview_unsafe)\n      ;(ref as any)(value)\n    },\n    [recyclerRef, ref]\n  )\n\n  return (\n    // @ts-expect-error typescript complains about `unknown` in the memo, it should be T\n    <FlashListMemo\n      {...rest}\n      onLayout={onLayout}\n      ref={refWorkaround}\n      contentContainerStyle={memoContentContainerStyle}\n      bouncesZoom={false}\n      onScroll={scrollHandler}\n      scrollEventThrottle={16}\n      contentInset={memoContentInset}\n      contentOffset={memoContentOffset}\n      refreshControl={memoRefreshControl}\n      progressViewOffset={progressViewOffset}\n      automaticallyAdjustContentInsets={false}\n      onContentSizeChange={scrollContentSizeChangeHandlers}\n    />\n  )\n}\n\n/**\n * Use like a regular FlashList.\n */\nexport const FlashList = React.forwardRef(FlashListImpl) as <T>(\n  p: FlashListProps<T> & { ref?: React.Ref<SPFlashList<T>> }\n) => React.ReactElement\n"],"mappings":"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"}